<!-- Hidden Source Container -->
<div id="projects-source" style="display: none;">

  <!-- Remote Projects -->
  {% for remote_project in page.remote_projects %}
  {%- for repo in site.github.public_repositories -%}
  {%- if remote_project == repo.name -%}
  {%- assign project = repo -%}
  {%- assign words = project.name | split: '-' -%}
  {%- capture titlecase -%}
  {%- for word in words -%}
  {{ word | capitalize | append: ' ' }}
  {%- endfor -%}
  {%- endcapture -%}
  {%- assign project_type = "remote" -%}
  {%- assign project_id = project.name -%}
  {%- assign project_img = false -%}
  {%- assign project_name = titlecase | strip -%}
  {%- assign project_desc = project.description -%}
  {%- assign project_url = project.html_url -%}
  {%- assign project_tools = project.topics -%}
  {%- assign external = true -%}
  {% include projects/project-card.html %}
  {%- endif -%}
  {%- endfor -%}
  {% endfor %}

  <!-- Local Projects -->
  {% for project in site.projects %}
  {%- assign project_type = "local" -%}
  {%- assign project_id = project.name | slugify -%}
  {%- assign project_img = project.image -%}
  {%- assign project_name = project.name -%}
  {%- assign project_desc = project.description -%}
  {%- assign project_tools = project.tools -%}
  {%- if project.external_url -%}
  {%- assign project_url = project.external_url -%}
  {%- assign external = true -%}
  {%- else -%}
  {%- assign project_slug = project.name | slugify -%}
  {%- assign project_url = '/projects/' | append: project_slug | relative_url -%}
  {%- assign external = false -%}
  {%- endif -%}
  {% include projects/project-card.html %}
  {% endfor %}

</div>

<!-- Display Container -->
<div id="masonry-grid" class="masonry-grid m-3 mt-5">
  <!-- Columns will be injected here by JS -->
</div>

<script>
  (function () {
    const source = document.getElementById('projects-source');
    const grid = document.getElementById('masonry-grid');
    if (!source || !grid) return;

    let resizeTimeout;

    function renderMasonry() {
      // 1. Determine number of columns
      let numCols = 3;
      if (window.innerWidth <= 768) {
        numCols = 1;
      } else if (window.innerWidth <= 1200) {
        numCols = 2;
      }

      // 2. Create column elements
      grid.innerHTML = ''; // Clear existing
      const columns = [];
      for (let i = 0; i < numCols; i++) {
        const col = document.createElement('div');
        col.className = 'masonry-column';
        grid.appendChild(col);
        columns.push(col);
      }

      // 3. Distribute cards
      // We clone the cards from source to avoid messing up the source order/state
      const cards = Array.from(source.children);

      cards.forEach((card, index) => {
        const colIndex = index % numCols; // 0, 1, 2, 0, 1, 2...
        // Clone the card so we can re-use the source on resize
        const cardClone = card.cloneNode(true);
        columns[colIndex].appendChild(cardClone);
      });
    }

    // Initial render
    renderMasonry();

    // Debounce resize
    window.addEventListener('resize', function () {
      clearTimeout(resizeTimeout);
      resizeTimeout = setTimeout(renderMasonry, 200);
    });
  })();
</script>